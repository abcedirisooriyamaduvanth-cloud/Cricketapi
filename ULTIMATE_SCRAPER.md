# Ultimate Scraper - Captures EVERYTHING

## The Problem

You said you can see `.m3u8` and `.ts` links in the Network tab, but the scraper wasn't finding them. This means:
- The links exist
- Our detection wasn't catching them
- Timing or filtering was wrong

## The Solution: `scraper_ultimate.py`

### What's Different

1. **Captures BOTH Requests AND Responses**
   - Previous scrapers only captured requests
   - Now captures responses too (where m3u8 might appear)

2. **Checks Content-Type Headers**
   - Looks for `application/vnd.apple.mpegurl`
   - Catches m3u8 even if URL doesn't contain ".m3u8"

3. **Shows ALL Candidates**
   - Lists every .m3u8 and .ts URL found
   - Numbered list so you can see exactly what was captured

4. **Filters .ts from .m3u8**
   - Separates playlist files (.m3u8) from segments (.ts)
   - Prefers master playlists over variant playlists

5. **60 Second Wait**
   - Waits full 60 seconds (12 x 5s intervals)
   - Shows progress every 5 seconds
   - Reports when candidates are found

## Expected Output

### When It Finds m3u8

```
ğŸ¯ REQUEST: https://d10.merichunidya.com:1686/hls/willowextra.m3u8?md5=...
ğŸ¯ RESPONSE: https://d10.merichunidya.com:1686/hls/willowextra.m3u8?md5=...
Found 2 candidate(s) after 15s!

ğŸ“Š Debug Info:
Total requests: 247
Total responses: 189
M3U8 candidates: 15

ğŸ¯ All M3U8/TS URLs found:
1. [request] https://d10.merichunidya.com:1686/hls/willowextra.m3u8?md5=...
2. [response] https://d10.merichunidya.com:1686/hls/willowextra.m3u8?md5=...
3. [request] https://d10.merichunidya.com:1686/hls/segment001.ts
4. [request] https://d10.merichunidya.com:1686/hls/segment002.ts
...

âœ… Found 1 m3u8 playlist(s)
Using latest m3u8

âœ… SUCCESS!
   Link: https://d10.merichunidya.com:1686/hls/willowextra.m3u8?md5=...
   Headers: ['Origin', 'Referer', 'User-Agent']
âœ… Saved to Firebase: 2ndserverlink
```

### When It Only Finds .ts Segments

```
ğŸ¯ REQUEST: https://example.com/segment001.ts
ğŸ¯ REQUEST: https://example.com/segment002.ts
ğŸ¯ REQUEST: https://example.com/segment003.ts
Found 3 candidate(s) after 20s!

ğŸ“Š Debug Info:
Total requests: 189
Total responses: 156
M3U8 candidates: 15

ğŸ¯ All M3U8/TS URLs found:
1. [request] https://example.com/segment001.ts
2. [request] https://example.com/segment002.ts
3. [request] https://example.com/segment003.ts
...

âŒ No m3u8 playlists found
   Found 15 .ts segments but no .m3u8 playlist
   This might mean the playlist loaded before we started listening
```

**This tells you**: The stream IS active, but the .m3u8 playlist loaded before we started capturing.

## What This Means

### Scenario 1: Shows m3u8 URLs âœ…
**Perfect!** The scraper found and will save the m3u8 link to Firebase.

### Scenario 2: Shows only .ts URLs âš ï¸
**Stream is active** but playlist loaded too early.

**Solutions:**
1. The .ts URLs contain the base URL - you can construct the m3u8 URL
2. Increase initial wait before interaction
3. Reload page after setting up listeners

### Scenario 3: Shows nothing âŒ
**Stream not active** or uses different technology.

## Deployment

### Push to GitHub

```bash
git add .
git commit -m "Add ultimate scraper that captures all network traffic

- Captures both requests and responses
- Checks content-type headers for HLS
- Shows all m3u8 and ts URLs found
- Filters playlists from segments
- 60 second wait with progress updates"

git push origin main
```

### Run Workflow

1. Go to Actions tab
2. Click "Scrape Cricket Streams"
3. Click "Run workflow"
4. Wait ~2 minutes
5. Check logs for:
   - `ğŸ¯ REQUEST/RESPONSE` messages
   - List of all m3u8/ts URLs found
   - Success or detailed failure info

## Understanding the Output

### Good Signs

- âœ… See `ğŸ¯ REQUEST:` with .m3u8 URLs
- âœ… See `ğŸ¯ RESPONSE:` with .m3u8 URLs
- âœ… See "Found X m3u8 playlist(s)"
- âœ… See "âœ… SUCCESS!"

### Needs Investigation

- âš ï¸ See only .ts segments, no .m3u8
  - Stream is active but playlist loaded early
  - Can extract base URL from .ts paths
  
- âš ï¸ See "M3U8 candidates: 0"
  - Stream not active
  - Or uses different tech (DASH, WebRTC)

## If Still No m3u8

If the ultimate scraper shows:
```
M3U8 candidates: 0
```

But you can see m3u8 in browser DevTools, then:

1. **Timing Issue**: m3u8 loads before page.goto() completes
   - Solution: Add delay before goto, or reload page

2. **Different Domain**: m3u8 is on different domain not captured
   - Solution: Check if cross-origin requests are blocked

3. **Dynamic Generation**: m3u8 URL is generated by JavaScript
   - Solution: Need to trigger specific actions

## Manual Extraction

If automated scraping continues to fail:

1. Visit the URL in browser
2. Open DevTools â†’ Network tab
3. Filter by "m3u8"
4. Copy the m3u8 URL when it appears
5. Note the pattern (domain, path, query params)
6. Add to scraper as a direct URL to check

Example:
```python
# If you always see: https://d10.merichunidya.com:1686/hls/willowextra.m3u8
# Add direct check:
test_url = "https://d10.merichunidya.com:1686/hls/willowextra.m3u8"
try:
    response = requests.head(test_url, timeout=5)
    if response.status_code == 200:
        print(f"Direct URL works: {test_url}")
except:
    pass
```

## Next Steps

1. **Push code** to GitHub
2. **Run workflow** and check logs
3. **Look for** the numbered list of m3u8/ts URLs
4. **If you see .ts but no .m3u8**: The stream is active, just need to catch the playlist earlier
5. **If you see nothing**: Stream not active or different tech

The ultimate scraper will show you EXACTLY what network requests contain m3u8 or ts, so you'll know if the stream is there or not.
